#!/usr/bin/env python
from datetime import date

mindate = date(2015,3,22)

schedulename = "Spring 2015 (Mar 22, 2015 - Jun 13, 2015)"

def text():
    return """
bainbridge,wd,330,370,425,475,525,575,640,685,740,790,845,900,945,1000,1050,1100,1160,1210,1260,1325,1375,1455,1535
bainbridge,we,370,475,525,575,635,685,740,790,845,900,945,1000,1050,1100,1160,1210,1260,1305,1360,1395,1485,1570
bainbridge,ed,285,320,380,425,475,525,580,625,690,740,790,845,895,950,995,1050,1110,1150,1210,1255,1305,1415,1495
bainbridge,ee,320,425,525,575,625,690,740,790,845,895,950,995,1050,1110,1150,1210,1255,1305,1350,1440,1525
edmonds,wd,335,380,430,475,530,580,630,670,725,760,820,865,915,955,1005,1045,1095,1140,1180,1230,1260,1345,1425
edmonds,we,430,475,530,580,630,670,725,760,820,865,915,955,1005,1045,1095,1140,1180,1230,1260,1310,1345,1390,1425
edmonds,ed,295,335,385,425,475,520,580,625,675,715,770,810,870,910,960,1000,1050,1090,1140,1185,1220,1300,1385
edmonds,ee,385,425,475,520,580,625,675,715,770,810,870,910,960,1000,1050,1090,1140,1185,1220,1270,1300,1350,1385
mukilteo,wd,305,335,360,390,420,450,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1175,1200,1225,1260,1320,1380,1440,1505
mukilteo,we,360,420,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1175,1200,1225,1260,1285,1320,1380,1440,1505
mukilteo,ed,280,310,330,360,390,420,450,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1170,1200,1230,1290,1350,1410,1470
mukilteo,ee,330,390,450,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1170,1200,1230,1255,1290,1350,1410,1470
pt townsend,wd,420,510,615,795,885,975,1080,1170,1270
pt townsend,we,435,525,795,885,975,1080,1170,1270
pt townsend,ed,375,465,555,750,840,930,1035,1125,1230
pt townsend,ee,390,480,750,840,930,1035,1125,1230
fauntleroy-southworth,wd,265,310,350,425,470,525,545,570,620,695,740,820,855,900,935,980,1030,1065,1115,1170,1255,1340,1420,1495,1570
fauntleroy-southworth,we,310,365,410,455,515,555,610,645,700,740,820,860,900,960,1000,1080,1100,1180,1340,1420,1495,1570
southworth-fauntleroy,ed,260,300,360,400,475,500,560,595,615,670,745,790,865,890,945,965,1030,1075,1110,1160,1225,1385,1465,1540
southworth-fauntleroy,ee,260,360,410,460,500,560,600,655,690,745,790,865,910,950,1010,1050,1115,1150,1225,1385,1465,1540
fauntleroy-vashon,wd,310,350,370,410,425,505,545,570,620,640,675,695,715,740,775,805,820,885,900,960,1005,1030,1065,1085,1115,1145,1170,1205,1255,1280,1340,1420,1495,1570
fauntleroy-vashon,we,310,365,410,455,515,555,610,645,700,740,770,800,820,840,860,900,920,960,980,1000,1030,1060,1100,1120,1160,1180,1200,1280,1340,1420,1495,1570
vashon-fauntleroy,ed,245,280,320,345,380,400,420,440,475,495,520,540,580,615,635,690,710,745,765,830,860,925,995,1030,1055,1115,1140,1180,1230,1245,1315,1365,1445,1520
vashon-fauntleroy,ee,280,335,380,430,480,520,580,620,675,710,740,765,795,810,830,870,885,930,950,970,1005,1030,1055,1070,1090,1135,1150,1170,1245,1315,1365,1445,1520
vashon-southworth,wd,245,335,375,450,570,595,645,720,765,845,925,1055,1090,1140,1195,1280,1365,1445,1520,1600
vashon-southworth,we,335,390,440,480,540,580,635,670,725,770,845,885,925,985,1025,1125,1205,1365,1445,1520,1600
southworth-vashon,ed,260,300,360,400,475,500,560,595,615,670,745,790,865,965,1030,1110,1160,1225,1385,1465,1540
southworth-vashon,ee,260,360,410,460,500,560,600,655,690,745,790,865,910,950,1010,1050,1115,1150,1225,1385,1465,1540
bremerton,wd,360,455,510,600,670,755,810,900,980,1055,1125,1195,1265,1350,1490
bremerton,we,360,455,510,600,670,755,810,900,980,1055,1125,1195,1265,1350,1490
bremerton,ed,290,380,440,525,585,670,740,825,900,980,1050,1125,1195,1265,1420
bremerton,ee,380,440,525,585,670,740,825,900,980,1050,1125,1195,1265,1420
vashon-pt defiance,wd,330,380,430,480,530,580,630,680,730,850,910,965,1020,1080,1140,1200,1260,1320,1375
vashon-pt defiance,we,380,430,480,530,580,630,680,730,780,850,910,965,1020,1080,1140,1200,1260,1320,1375
pt defiance-vashon,ed,305,355,405,455,505,555,605,655,705,820,880,940,995,1050,1110,1165,1225,1290,1350
pt defiance-vashon,ee,355,405,455,505,555,605,655,705,755,820,880,940,995,1050,1110,1165,1225,1290,1350
friday harbor,wd,255,380,510,570,880,990,1080,1225
friday harbor,we,255,380,510,570,880,990,1080,1225
friday harbor,ed,345,485,665,835,975,1105,1185,1325
friday harbor,ee,345,485,665,835,855,975,1105,1185,1325
orcas,wd,330,450,635,940,1110,1255
orcas,we,330,450,635,835,940,1110,1255
orcas,ed,405,525,745,1035,1190,1325
orcas,ee,405,525,745,915,1035,1190,1325
"""

def versionify(text,version):
    """Correct schedule details for different client versions"""
    if version == "1.0":
        return text
    elif version == "2.0":
        return v2interpolate(text)
    elif version == "3.0":
        return text
    else: # V4 and higher
        return v4plus(text)

def v2interpolate(text):
    """V2 clients leave off the first two times, so put dummy ones in"""
    result = ""
    for line in text.split('\n'):
        if len(line) < 2:
            result += line
        else:
            result += "{0[0]},{0[1]},333,333,{0[2]}\n".format(line.split(',',2))
    return result

def v4plus(text):
    """At V4 we turned the direction of pt defiance around"""
    result = ""
    for line in text.split('\n'):
        if line.startswith("pt defiance-vashon,e"):
            line = line.replace("pt defiance-vashon,e","pt defiance-vashon,w")
        elif line.startswith("vashon-pt defiance,w"):
            line = line.replace("vashon-pt defiance,w","vashon-pt defiance,e")
        result += line + "\n"
    return result

def isHoliday():
    """Update this every time the schedule is updated"""
    today = date.today()
    return( today == date(2015,5,25) )

def holidaySchedule():
    # only a few routes have different schedules on the holiday:
    # typically bainbridge, mukilteo and pt defiance

    schedule = """
bainbridge,ws,370,475,525,575,635,685,740,790,845,900,945,1000,1050,1100,1160,1210,1260,1305,1360,1395,1485,1570
bainbridge,es,320,425,525,575,625,690,740,790,845,895,950,995,1050,1110,1150,1210,1255,1305,1350,1440,1525
vashon-pt defiance,ws,380,430,480,530,580,630,680,730,780,850,910,965,1020,1080,1140,1200,1260,1320,1375
pt defiance-vashon,es,355,405,455,505,555,605,655,705,755,820,880,940,995,1050,1110,1165,1225,1290,1350
mukilteo,ws,360,420,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1175,1200,1225,1260,1285,1320,1380,1440,1505
mukilteo,es,330,390,450,480,510,540,570,600,630,660,690,720,750,780,810,840,870,900,930,960,990,1020,1050,1080,1110,1140,1170,1200,1230,1255,1290,1350,1410,1470
edmonds,ws,335,430,475,530,580,630,670,725,760,820,865,915,955,1005,1045,1095,1140,1180,1230,1260,1310,1345,1425
edmonds,es,295,385,425,475,520,580,625,675,715,770,810,870,910,960,1000,1050,1090,1140,1185,1220,1250,1300,1385
"""

    # if some routes are only on some holidays, modify schedule here.
#     if date.today() == date(2014,9,1):
#         schedule += """
# friday harbor,ws,255,385,540,715,840,1005,1220
# friday harbor,es,345,485,655,830,855,945,1110,1320
# orcas,ws,360,445,620,755,950,1160,1260
# orcas,es,435,530,725,860,1040,1245,1370
# """
    return schedule

